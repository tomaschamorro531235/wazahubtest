local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

-- Servicios y variables
local lp = game.Players.LocalPlayer
local RS = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local Camera = workspace.CurrentCamera

local correctedSpeed = 45
local normalFOV = Camera.FieldOfView
local originalEffects = {}
local movementConnection = nil

-- Función para guardar efectos visuales
local function saveOriginalEffects()
	originalEffects = {}
	for _, effect in pairs(Lighting:GetChildren()) do
		if effect:IsA("ColorCorrectionEffect") or effect:IsA("BlurEffect") then
			table.insert(originalEffects, effect:Clone())
		end
	end
end

-- Restaurar efectos originales
local function restoreOriginalEffects()
	for _, effect in pairs(Lighting:GetChildren()) do
		if effect:IsA("ColorCorrectionEffect") or effect:IsA("BlurEffect") then
			effect:Destroy()
		end
	end
	for _, original in ipairs(originalEffects) do
		original.Parent = Lighting
	end
end

-- Obtener dirección de movimiento de la cámara
local function getCameraInputDirection()
	local dir = Vector3.zero
	if UIS:IsKeyDown(Enum.KeyCode.W) then dir += Camera.CFrame.LookVector end
	if UIS:IsKeyDown(Enum.KeyCode.S) then dir -= Camera.CFrame.LookVector end
	if UIS:IsKeyDown(Enum.KeyCode.D) then dir += Camera.CFrame.RightVector end
	if UIS:IsKeyDown(Enum.KeyCode.A) then dir -= Camera.CFrame.RightVector end
	return Vector3.new(dir.X, 0, dir.Z).Unit
end

-- Crear ventana Rayfield
local Window = Rayfield:CreateWindow({
	Name = "Protecciones",
	LoadingTitle = "Cargando Protecciones...",
	LoadingSubtitle = "by waza",
	ConfigurationSaving = {
		Enabled = false
	},
	Discord = {
		Enabled = false
	},
	KeySystem = false
})

-- Tab de protección
local Tab_Proteccion = Window:CreateTab("Protección", 4483362458)

-- Toggle Anti Bee Launcher
Tab_Proteccion:CreateToggle({
	Name = "Anti Bee Launcher",
	CurrentValue = false,
	Callback = function(enabled)
		if movementConnection then
			movementConnection:Disconnect()
			movementConnection = nil
		end

		if enabled then
			saveOriginalEffects()

			Rayfield:Notify({
				Title = "Protección Activada",
				Content = "El Anti Bee Launcher ha sido desactivado correctamente.",
				Duration = 4
			})

			movementConnection = RS.RenderStepped:Connect(function()
				local char = lp.Character
				if not char then return end

				local hrp = char:FindFirstChild("HumanoidRootPart")
				local hum = char:FindFirstChildOfClass("Humanoid")
				local cam = workspace.CurrentCamera
				if not hrp or not hum or not cam then return end

				-- Remover efectos visuales
				for _, v in pairs(Lighting:GetChildren()) do
					if v:IsA("ColorCorrectionEffect") or v:IsA("BlurEffect") then
						v:Destroy()
					end
				end

				-- Restaurar FOV
				if cam.FieldOfView ~= normalFOV then
					cam.FieldOfView = normalFOV
				end

				-- Corregir velocidad
				local inputDir = getCameraInputDirection()
				local vel = hrp.AssemblyLinearVelocity

				if inputDir ~= Vector3.zero then
					local dot = vel.Magnitude > 0 and vel.Unit:Dot(inputDir) or 1

					if dot < -0.3 then
						hum:Move(Vector3.zero, true)
						hrp.AssemblyLinearVelocity = inputDir * correctedSpeed
					else
						hrp.AssemblyLinearVelocity = inputDir * correctedSpeed
					end
				else
					hrp.AssemblyLinearVelocity = Vector3.new(0, vel.Y, 0)
				end
			end)
		else
			if movementConnection then
				movementConnection:Disconnect()
				movementConnection = nil
			end

			restoreOriginalEffects()
			if Camera then Camera.FieldOfView = normalFOV end

			Rayfield:Notify({
				Title = "Protección Desactivada",
				Content = "Pantalla restaurada correctamente.",
				Duration = 3
			})
		end
	end
})
